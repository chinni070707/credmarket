{% extends 'base.html' %}

{% block content %}
<!-- Clean Hero Section -->
<div class="bg-green-600 py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-2xl md:text-3xl font-bold text-white mb-4">Buy & Sell with Verified Corporate Employees</h1>
        <p class="text-base md:text-lg text-green-100 mb-8 max-w-2xl mx-auto">India's trusted marketplace for employees from top companies. No spam, no scams.</p>
        
        <!-- Search Bar -->
        <form action="{% url 'listings:listing_list' %}" method="GET" class="max-w-3xl mx-auto mb-8">
            <div class="relative">
                <input type="text" name="q" placeholder="Search for electronics, furniture, vehicles..."
                       class="w-full px-6 py-4 pr-16 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-green-300 shadow-lg"
                       value="{{ request.GET.q|default:'' }}">
                <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 px-6 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors">
                    <i class="fas fa-search mr-2"></i>Search
                </button>
            </div>
        </form>

        <!-- Primary CTA -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
            <a href="{% url 'listings:listing_list' %}" class="inline-block bg-white text-green-600 px-8 py-3 rounded-lg font-semibold hover:bg-green-50 transition-colors shadow-md">
                <i class="fas fa-shopping-bag mr-2"></i>Browse Listings
            </a>
            <a href="{% url 'listings:create_listing' %}" class="inline-block bg-green-700 text-white px-8 py-3 rounded-lg font-semibold hover:bg-green-800 transition-colors shadow-md">
                <i class="fas fa-plus-circle mr-2"></i>Post Free Ad
            </a>
        </div>
    </div>
</div>

<!-- Trust Badges Section -->
<div class="bg-gray-50 py-12 border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <div class="flex items-center gap-3 p-4 bg-white rounded-lg shadow-sm">
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-user-check text-green-600 text-xl"></i>
                </div>
                <div>
                    <div class="font-semibold text-gray-900 text-sm">Verified Users</div>
                    <div class="text-xs text-gray-600">Corporate emails only</div>
                </div>
            </div>
            <div class="flex items-center gap-3 p-4 bg-white rounded-lg shadow-sm">
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-comments text-blue-600 text-xl"></i>
                </div>
                <div>
                    <div class="font-semibold text-gray-900 text-sm">Secure Chat</div>
                    <div class="text-xs text-gray-600">Safe messaging</div>
                </div>
            </div>
            <div class="flex items-center gap-3 p-4 bg-white rounded-lg shadow-sm">
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-hand-holding-dollar text-green-600 text-xl"></i>
                </div>
                <div>
                    <div class="font-semibold text-gray-900 text-sm">Zero Commission</div>
                    <div class="text-xs text-gray-600">100% free</div>
                </div>
            </div>
            <div class="flex items-center gap-3 p-4 bg-white rounded-lg shadow-sm">
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-location-dot text-blue-600 text-xl"></i>
                </div>
                <div>
                    <div class="font-semibold text-gray-900 text-sm">Local Deals</div>
                    <div class="text-xs text-gray-600">Meet in person</div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Categories Section -->
<div class="bg-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-8">Shop by Category</h2>
        
        <!-- Categories Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
            {% for category in categories %}
            <a href="{% url 'listings:listing_list' %}?category={{ category.id }}" 
               class="flex flex-col items-center p-6 bg-white border border-gray-200 rounded-lg hover:border-green-500 hover:shadow-md transition-all group">
                {% if category.image %}
                <div class="w-16 h-16 mb-3 overflow-hidden rounded-lg">
                    <img src="{{ category.image.url }}" alt="{{ category.name }}" class="w-full h-full object-cover">
                </div>
                {% else %}
                <div class="w-16 h-16 mb-3 bg-gray-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-box text-gray-400 text-2xl"></i>
                </div>
                {% endif %}
                <div class="text-sm font-semibold text-gray-900 text-center group-hover:text-green-600 truncate w-full">{{ category.name }}</div>
                <div class="text-xs text-gray-500 mt-1">{{ category.listing_count|default:0 }} items</div>
            </a>
            {% empty %}
            <!-- Default categories if database is empty -->
            <a href="{% url 'listings:listing_list' %}?category=electronics" class="flex flex-col items-center p-6 bg-white border border-gray-200 rounded-lg hover:border-green-500 hover:shadow-md transition-all group">
                <div class="w-16 h-16 mb-3 bg-blue-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-mobile-alt text-blue-600 text-2xl"></i>
                </div>
                <div class="text-sm font-semibold text-gray-900 group-hover:text-green-600">Electronics</div>
            </a>
            <a href="{% url 'listings:listing_list' %}?category=furniture" class="flex flex-col items-center p-6 bg-white border border-gray-200 rounded-lg hover:border-green-500 hover:shadow-md transition-all group">
                <div class="w-16 h-16 mb-3 bg-amber-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-couch text-amber-600 text-2xl"></i>
                </div>
                <div class="text-sm font-semibold text-gray-900 group-hover:text-green-600">Furniture</div>
            </a>
            <a href="{% url 'listings:listing_list' %}?category=books" class="flex flex-col items-center p-6 bg-white border border-gray-200 rounded-lg hover:border-green-500 hover:shadow-md transition-all group">
                <div class="w-16 h-16 mb-3 bg-green-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-book text-green-600 text-2xl"></i>
                </div>
                <div class="text-sm font-semibold text-gray-900 group-hover:text-green-600">Books</div>
            </a>
            <a href="{% url 'listings:listing_list' %}?category=fashion" class="flex flex-col items-center p-6 bg-white border border-gray-200 rounded-lg hover:border-green-500 hover:shadow-md transition-all group">
                <div class="w-16 h-16 mb-3 bg-pink-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-tshirt text-pink-600 text-2xl"></i>
                </div>
                <div class="text-sm font-semibold text-gray-900 group-hover:text-green-600">Fashion</div>
            </a>
            <a href="{% url 'listings:listing_list' %}?category=sports" class="flex flex-col items-center p-6 bg-white border border-gray-200 rounded-lg hover:border-green-500 hover:shadow-md transition-all group">
                <div class="w-16 h-16 mb-3 bg-cyan-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-futbol text-cyan-600 text-2xl"></i>
                </div>
                <div class="text-sm font-semibold text-gray-900 group-hover:text-green-600">Sports</div>
            </a>
            <a href="{% url 'listings:listing_list' %}?category=other" class="flex flex-col items-center p-6 bg-white border border-gray-200 rounded-lg hover:border-green-500 hover:shadow-md transition-all group">
                <div class="w-16 h-16 mb-3 bg-gray-100 rounded-lg flex items-center justify-center">
                    <i class="fas fa-ellipsis-h text-gray-600 text-2xl"></i>
                </div>
                <div class="text-sm font-semibold text-gray-900 group-hover:text-green-600">Others</div>
            </a>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Recently Viewed Items (for logged in users) -->
{% if user.is_authenticated %}
<div class="bg-white py-12" id="recentlyViewedSection" style="display: none;">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900">
                <i class="fas fa-history text-purple-600 mr-2"></i>Recently Viewed
            </h2>
            <button onclick="clearRecentlyViewed()" class="text-sm text-gray-500 hover:text-red-600">
                <i class="fas fa-trash mr-1"></i>Clear History
            </button>
        </div>
        <div id="recentlyViewedGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
            <!-- Populated by JavaScript -->
        </div>
    </div>
</div>
{% endif %}

<!-- Recent Listings -->
<div class="bg-gray-50 py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-bold text-gray-900">Latest Listings</h2>
            <a href="{% url 'listings:listing_list' %}" class="text-green-600 font-semibold hover:text-green-700 text-sm">
                View All <i class="fas fa-arrow-right ml-1"></i>
            </a>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="listingsGrid">
            <!-- Skeleton Loading States -->
            <div class="skeleton-card" style="display: none;">
                <div class="aspect-square bg-gray-200 rounded-t-xl skeleton animate-pulse"></div>
                <div class="p-4 space-y-3">
                    <div class="h-6 bg-gray-200 rounded skeleton animate-pulse"></div>
                    <div class="h-4 bg-gray-200 rounded w-3/4 skeleton animate-pulse"></div>
                    <div class="h-4 bg-gray-200 rounded w-1/2 skeleton animate-pulse"></div>
                </div>
            </div>
            
            {% for listing in recent_listings %}
            <a href="{% url 'listings:listing_detail' listing.id %}" class="bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-xl transition-all group">
                {% if listing.get_primary_image %}
                <div class="aspect-square overflow-hidden bg-gray-100 relative">
                    <img src="{{ listing.get_primary_image.image.url }}" alt="{{ listing.title }}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
                    <!-- Company Badge - Top Right -->
                    {% if listing.seller.company %}
                    <div class="absolute top-2 right-2 bg-white/95 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-semibold text-purple-600 shadow-lg border border-purple-200">
                        <i class="fas fa-building mr-1"></i>{{ listing.seller.company.name|truncatewords:2 }}
                    </div>
                    {% endif %}
                    <!-- Negotiable Badge - Bottom Left -->
                    <div class="absolute bottom-2 left-2 px-3 py-1 rounded-full text-xs font-semibold shadow-lg
                        {% if listing.negotiable %}
                            bg-green-500/95 text-white
                        {% else %}
                            bg-orange-500/95 text-white
                        {% endif %}">
                        {% if listing.negotiable %}
                            <i class="fas fa-handshake mr-1"></i>Negotiable
                        {% else %}
                            <i class="fas fa-tag mr-1"></i>Fixed Price
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="aspect-square bg-gray-100 flex items-center justify-center relative">
                    <i class="fas fa-box text-gray-300 text-6xl"></i>
                    <!-- Company Badge - Top Right -->
                    {% if listing.seller.company %}
                    <div class="absolute top-2 right-2 bg-white/95 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-semibold text-green-600 shadow-lg border border-green-200">
                        <i class="fas fa-building mr-1"></i>{{ listing.seller.company.name|truncatewords:2 }}
                    </div>
                    {% endif %}
                    <!-- Negotiable Badge - Bottom Left -->
                    <div class="absolute bottom-2 left-2 px-3 py-1 rounded-full text-xs font-semibold shadow-lg
                        {% if listing.negotiable %}
                            bg-green-500/95 text-white
                        {% else %}
                            bg-blue-500/95 text-white
                        {% endif %}">
                        {% if listing.negotiable %}
                            <i class="fas fa-handshake mr-1"></i>Negotiable
                        {% else %}
                            <i class="fas fa-tag mr-1"></i>Fixed Price
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                <div class="p-4">
                    <div class="text-xl font-bold text-green-600 mb-2">₹{{ listing.price|floatformat:0 }}</div>
                    <h3 class="font-semibold text-gray-900 mb-2 line-clamp-2 text-sm">{{ listing.title }}</h3>
                    <div class="text-xs text-gray-500">
                        <i class="fas fa-map-marker-alt mr-1"></i>{{ listing.city|default:"India" }}
                    </div>
                </div>
            </a>
            {% empty %}
            <div class="col-span-full text-center text-gray-500 py-12">
                <i class="fas fa-box-open text-gray-300 text-6xl mb-4"></i>
                <p>No listings yet. Be the first to post!</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
// Recently Viewed Items Management
function getRecentlyViewed() {
    const viewed = localStorage.getItem('recentlyViewed');
    return viewed ? JSON.parse(viewed) : [];
}

function addToRecentlyViewed(listingId, title, price, image) {
    let viewed = getRecentlyViewed();
    // Remove if already exists
    viewed = viewed.filter(item => item.id !== listingId);
    // Add to beginning
    viewed.unshift({ id: listingId, title, price, image, timestamp: Date.now() });
    // Keep only last 12 items
    viewed = viewed.slice(0, 12);
    localStorage.setItem('recentlyViewed', JSON.stringify(viewed));
}

function displayRecentlyViewed() {
    const viewed = getRecentlyViewed();
    const section = document.getElementById('recentlyViewedSection');
    const grid = document.getElementById('recentlyViewedGrid');
    
    if (viewed.length === 0 || !section || !grid) return;
    
    section.style.display = 'block';
    grid.innerHTML = viewed.map(item => `
        <a href="/listings/${item.id}/" class="bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all group">
            <div class="aspect-square overflow-hidden bg-gray-100">
                <img src="${item.image || '/static/placeholder.png'}" alt="${item.title}" class="w-full h-full object-cover group-hover:scale-105 transition-transform">
            </div>
            <div class="p-3">
                <div class="font-bold text-green-600 text-sm mb-1">₹${item.price}</div>
                <div class="text-xs text-gray-700 truncate">${item.title}</div>
            </div>
        </a>
    `).join('');
}

function clearRecentlyViewed() {
    if (confirm('Clear your browsing history?')) {
        localStorage.removeItem('recentlyViewed');
        document.getElementById('recentlyViewedSection').style.display = 'none';
    }
}

// Initialize recently viewed on page load
if (document.getElementById('recentlyViewedSection')) {
    displayRecentlyViewed();
}
</script>

{% endblock %}
