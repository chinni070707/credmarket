{% extends 'base.html' %}

{% block title %}Edit Profile - CredMarket{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Edit Profile</h1>
                <p class="text-gray-600">Update your personal information and preferences</p>
            </div>
            <a href="{% url 'accounts:profile' %}" class="text-green-600 hover:text-green-700 font-semibold">
                <i class="fas fa-arrow-left mr-2"></i> Back to Profile
            </a>
        </div>
    </div>

    <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        
        <!-- Profile Picture -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-camera text-green-600 mr-2"></i> Profile Picture
            </h2>
            
            <div class="flex items-center space-x-6">
                <!-- Current Picture -->
                <div class="flex-shrink-0">
                    {% if user.profile_picture %}
                        <img src="{{ user.profile_picture.url }}" alt="Profile" class="w-24 h-24 rounded-full border-4 border-green-100">
                    {% else %}
                        <div class="w-24 h-24 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white text-3xl font-bold">
                            {{ user.first_name.0 }}{{ user.last_name.0 }}
                        </div>
                    {% endif %}
                </div>
                
                <!-- Upload -->
                <div class="flex-1">
                    <label for="profile_picture" class="block text-sm font-medium text-gray-700 mb-2">
                        Upload New Picture
                    </label>
                    <input 
                        type="file" 
                        name="profile_picture" 
                        id="profile_picture"
                        accept="image/*"
                        class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100"
                    >
                    <p class="mt-1 text-xs text-gray-500">JPG, PNG or GIF (Max 2MB)</p>
                </div>
            </div>
        </div>

        <!-- Personal Information -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-user text-green-600 mr-2"></i> Personal Information
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- First Name -->
                <div>
                    <label for="first_name" class="block text-sm font-medium text-gray-700 mb-2">
                        First Name <span class="text-red-500">*</span>
                    </label>
                    <input 
                        type="text" 
                        name="first_name" 
                        id="first_name" 
                        required
                        value="{{ user.first_name }}"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    >
                </div>

                <!-- Last Name -->
                <div>
                    <label for="last_name" class="block text-sm font-medium text-gray-700 mb-2">
                        Last Name <span class="text-red-500">*</span>
                    </label>
                    <input 
                        type="text" 
                        name="last_name" 
                        id="last_name" 
                        required
                        value="{{ user.last_name }}"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    >
                </div>
            </div>
        </div>

        <!-- Contact Information -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-phone text-green-600 mr-2"></i> Contact Information
            </h2>
            
            <div class="space-y-4">
                <!-- Email (Read-only) -->
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                        Email Address
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        value="{{ user.email }}"
                        disabled
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-500"
                    >
                    <p class="mt-1 text-xs text-gray-500">Email cannot be changed</p>
                </div>

                <!-- Phone -->
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">
                        Phone Number
                    </label>
                    <input 
                        type="tel" 
                        name="phone" 
                        id="phone" 
                        value="{{ user.phone|default:'' }}"
                        placeholder="+91 XXXXXXXXXX"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    >
                </div>
            </div>
        </div>

        <!-- Location -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-map-marker-alt text-green-600 mr-2"></i> Location
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- City -->
                <div>
                    <label for="location" class="block text-sm font-medium text-gray-700 mb-2">
                        City <span class="text-red-500">*</span>
                    </label>
                    <input 
                        type="text" 
                        name="location" 
                        id="location" 
                        required
                        value="{{ user.location }}"
                        placeholder="Bangalore"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    >
                </div>

                <!-- Area -->
                <div>
                    <label for="area" class="block text-sm font-medium text-gray-700 mb-2">
                        Area/Locality
                    </label>
                    <input 
                        type="text" 
                        name="area" 
                        id="area" 
                        value="{{ user.area|default:'' }}"
                        placeholder="Koramangala"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    >
                </div>
            </div>
        </div>

        <!-- Bio -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-quote-left text-green-600 mr-2"></i> About Me
            </h2>
            
            <div>
                <label for="bio" class="block text-sm font-medium text-gray-700 mb-2">
                    Bio
                </label>
                <textarea 
                    name="bio" 
                    id="bio" 
                    rows="4"
                    maxlength="500"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    placeholder="Tell us a bit about yourself..."
                >{{ user.bio|default:'' }}</textarea>
                <p class="mt-1 text-xs text-gray-500">Maximum 500 characters</p>
            </div>
        </div>

        <!-- Privacy Settings -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-shield-alt text-green-600 mr-2"></i> Privacy Settings
            </h2>
            
            <div class="space-y-4">
                <!-- Display Name -->
                <div>
                    <label for="display_name" class="block text-sm font-medium text-gray-700 mb-2">
                        Display Name in Listings
                    </label>
                    <input 
                        type="text" 
                        name="display_name" 
                        id="display_name" 
                        value="{{ user.display_name|default:'' }}"
                        placeholder="Leave empty to use real name"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                    >
                    <p class="mt-1 text-xs text-gray-500">This name will be shown in your listings instead of your real name</p>
                </div>

                <!-- Show Real Name -->
                <div class="flex items-center">
                    <input 
                        type="checkbox" 
                        name="show_real_name" 
                        id="show_real_name"
                        {% if user.show_real_name %}checked{% endif %}
                        class="w-4 h-4 border border-gray-300 rounded text-green-600 focus:ring-green-500"
                    >
                    <label for="show_real_name" class="ml-2 text-sm text-gray-700">
                        Show my real name in listings
                    </label>
                </div>
            </div>
        </div>

        <!-- Email Notification Preferences -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-envelope text-green-600 mr-2"></i> Email Notifications
            </h2>
            
            <div class="space-y-4">
                <p class="text-sm text-gray-600 mb-4">
                    All notifications will be sent to your personal email: <strong>{{ user.personal_email }}</strong>
                </p>
                
                <!-- New Listings Notification -->
                <div class="flex items-start">
                    <input 
                        type="checkbox" 
                        name="notify_new_company_listings" 
                        id="notify_new_company_listings"
                        {% if user.notify_new_company_listings %}checked{% endif %}
                        class="w-4 h-4 mt-1 border border-gray-300 rounded text-green-600 focus:ring-green-500"
                    >
                    <label for="notify_new_company_listings" class="ml-2">
                        <span class="block text-sm font-medium text-gray-700">New items in my company</span>
                        <span class="block text-xs text-gray-500">Get notified when someone from {{ user.company.name }} lists a new item</span>
                    </label>
                </div>
                
                <!-- Unread Messages Notification -->
                <div class="flex items-start">
                    <input 
                        type="checkbox" 
                        name="notify_unread_messages" 
                        id="notify_unread_messages"
                        {% if user.notify_unread_messages %}checked{% endif %}
                        class="w-4 h-4 mt-1 border border-gray-300 rounded text-green-600 focus:ring-green-500"
                    >
                    <label for="notify_unread_messages" class="ml-2">
                        <span class="block text-sm font-medium text-gray-700">Unread message reminders</span>
                        <span class="block text-xs text-gray-500">Remind me after 15 minutes if I haven't replied to a message</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div class="flex items-center justify-between bg-gray-50 rounded-xl p-6">
            <a href="{% url 'accounts:profile' %}" class="text-gray-600 hover:text-gray-900 font-semibold">
                <i class="fas fa-times mr-2"></i> Cancel
            </a>
            <button 
                type="submit" 
                class="btn-primary text-white px-8 py-3 rounded-lg font-bold flex items-center space-x-2"
            >
                <i class="fas fa-save"></i>
                <span>Save Changes</span>
            </button>
        </div>
    </form>
</div>
{% endblock %}
